<!DOCTYPE html> 
<html>
    <head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1"> 
        <title></title>  
        <script type="text/javascript" charset="utf-8" src="phonegap-1.3.0.js"></script>
        <link rel="stylesheet" href="jquery.mobile-1.0.css" />
        <link rel="stylesheet" href="master.css" /> 
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0.js"></script>
        <script>
       
        $(function() { 
	            $("#search_bt").click(function() {
	            	
	                var q = $.trim($("#q").val());
	 				
	                if(q.length > 0)
	                {
	                    $.ajax({
	                      type: "GET",
	                      url: "http://where.yahooapis.com/geocode?appid=dj0yJmk9aDNrOHUzMlU4ZkZiJmQ9WVdrOVkxVnhWelpOTldjbWNHbzlNVEl3TlRrME5EazJNZy0tJnM9Y29uc3VtZXJzZWNyZXQmeD0xZA--",
	                      data: ({q: q}),
	                      cache: false,
	                      dataType: "xml",
	                      success: onSuccess
	                    });
	                }
	                
	            });
	 
	            $("#resultLog").ajaxError(function(event, request, settings, exception) {	             
	              $("#resultLog").html("Error Calling: " + settings.url + "<br />HTPP Code: " + request.status);
	            });
	 
	            function onSuccess(data)
	            {
	            	
	            	var latitude = 0;
	            	var longitude = 0;
	            	if ($(data).find('Result').length == 1) {
	            	 	latitude = $(data).find('latitude').text();
	            	 	longitude = $(data).find('longitude').text();
	            	 	getBuoyInfo(latitude,longitude);
	            	 }
	            	 else
	            	 {
	            	 	alert('More than one location found. Please be more specific!');
	            	 }
	            
	                $("#resultLog").html("Result: " + data);
	            }
	            
	            function getBuoyInfo(latitude,longitude ) {	            	
	            	$.ajax({
	                      type: "GET",
	                      url: "http://www.ndbc.noaa.gov/rss/ndbc_obs_search.php?radius=100",
	                      data: ({lat: latitude,lon: longitude}),
	                      cache: false,
	                      dataType: "xml",
	                      success: onBuoySuccess
	                    });	            
	            }
	            
	            function onBuoySuccess(data)
	            {
	            	
	            	alert($(data).find('item').length);
	            }
	 
	        });
	    </script>
    </head>
    <body>
        <!-- Start of first page: welcome page -->
        <div data-role="page" id="welcome">
            <div data-role="header">
                <h2><img id="diveLogo" src="dive.jpg" />Dive Weather</h2>
            </div>
            <br />
            <!-- /header -->                    
            <form action="#" method="get" data-ajax="true" class="ui-body ui-body-a ui-corner-all">
				<fieldset>
					<div data-role="fieldcontain">
						<label for="q" class="input">Location (e.g. city, zip, etc):</label>
						<input type="text" name="q" id="q" value=""  />
					</div>
					<button type="button" data-theme="b" id="search_bt" name="search_bt" value="submit-value">Submit</button>
				</fieldset>
			</form>
			<div id="resultLog"></div>
            <div data-role="footer" data-theme="d">
                <h4>Navigation</h4>
            </div>
            <!-- /footer -->
        </div>
        <!-- /page one -->
        <!-- Start of second page: #tutorial -->
        <div data-role="page" id="tutorial" data-theme="a">
            <div data-role="header">
                <h1>Tutorial</h1>
            </div>
            <!-- /header -->
            <div data-role="content" data-theme="a">
                <h2>Tutorial</h2>
                <p>How to use....</p>
            </div>
            <!-- /content -->
            <div data-role="footer">
                <h4>Page Footer</h4>
            </div>
            <!-- /footer -->
        </div>
        <!-- /page tutorial -->        
    </body>
</html>